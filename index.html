<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>WILL AR - Laboratorio Matem√°tico</title>

<!-- LIBRER√çAS CORREGIDAS -->
<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/ar-js-org@3.4.4/aframe/build/aframe-ar.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

body {
  margin: 0;
  overflow: hidden;
  font-family: 'Segoe UI', sans-serif;
  background-color: #000;
  width: 100vw;
  height: 100vh;
  position: fixed;
  touch-action: manipulation;
  overscroll-behavior: none;
}

#init-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1e 100%);
  z-index: 9999;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: white;
  padding: 20px;
  text-align: center;
}

#init-screen.hidden {
  opacity: 0;
  pointer-events: none;
}

.init-logo {
  font-size: 3rem;
  margin-bottom: 15px;
  color: #3498db;
}

.init-title {
  font-size: 2rem;
  color: #ecf0f1;
  margin-bottom: 10px;
  font-weight: 700;
}

.init-desc {
  max-width: 85%;
  color: #bdc3c7;
  line-height: 1.6;
  margin: 15px 0 25px 0;
}

.btn-start {
  background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
  color: white;
  border: none;
  padding: 16px 40px;
  font-size: 1.3rem;
  border-radius: 15px;
  cursor: pointer;
  font-weight: bold;
  box-shadow: 0 6px 20px rgba(46, 204, 113, 0.5);
  margin-top: 15px;
  min-width: 260px;
  transition: all 0.2s;
}

.btn-start:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(46, 204, 113, 0.6);
}

.btn-start:active {
  transform: scale(0.97);
}

#https-warning {
  background: #e74c3c;
  color: white;
  padding: 12px;
  border-radius: 8px;
  margin: 20px 0;
  font-weight: bold;
  display: none;
}

#menu-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #2c3e50 0%, #0a0a15 100%);
  z-index: 9998;
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
  color: white;
}

.card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(10px);
  padding: 25px;
  border-radius: 18px;
  width: 95%;
  max-width: 420px;
  text-align: center;
  border: 1px solid rgba(255, 255, 255, 0.1);
  margin-bottom: 20px;
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
}

label {
  display: block;
  text-align: left;
  margin-top: 15px;
  margin-bottom: 8px;
  color: #ecf0f1;
  font-size: 0.9rem;
  font-weight: 500;
}

select {
  width: 100%;
  padding: 12px;
  border-radius: 10px;
  border: none;
  background: rgba(255, 255, 255, 0.12);
  color: white;
  font-size: 0.95rem;
  outline: none;
  border: 1px solid rgba(255, 255, 255, 0.15);
}

.file-input-wrapper {
  position: relative;
  width: 100%;
  margin-top: 10px;
}

.file-input-wrapper input[type="file"] {
  position: absolute;
  opacity: 0;
  width: 100%;
  height: 100%;
  cursor: pointer;
  z-index: 10;
}

.file-input-label {
  display: block;
  width: 100%;
  padding: 12px;
  background: rgba(142, 68, 173, 0.85);
  color: white;
  border-radius: 10px;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 0.95rem;
  font-weight: 500;
}

.file-input-label:hover {
  background: rgba(155, 89, 182, 0.95);
}

button {
  width: 100%;
  padding: 13px;
  margin-top: 15px;
  border-radius: 10px;
  border: none;
  font-size: 1.05rem;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-gen {
  background: linear-gradient(135deg, #2980b9 0%, #3498db 100%);
  color: white;
}

.btn-start-ar {
  background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
  color: white;
  font-size: 1.25rem;
  display: none;
  margin-top: 20px;
  padding: 15px;
}

.btn-back {
  background: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%);
  color: white;
  padding: 10px 25px;
  font-size: 0.95rem;
  width: auto;
  display: inline-block;
  min-width: 120px;
  margin-top: 15px;
}

#ar-scene-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 1;
  display: none;
}

#camera-status {
  position: fixed;
  top: 15px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(10, 10, 20, 0.92);
  color: #f39c12;
  padding: 10px 20px;
  border-radius: 25px;
  font-size: 1rem;
  z-index: 1001;
  border: 2px solid #f39c12;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
  font-weight: 600;
  backdrop-filter: blur(10px);
  max-width: 90%;
  text-align: center;
  display: none;
}

.status-ok {
  color: #27ae60 !important;
  border-color: #27ae60 !important;
}

#controls {
  position: fixed;
  bottom: 15px;
  left: 0;
  width: 100%;
  z-index: 1000;
  text-align: center;
  padding: 0 15px;
  display: none;
}

.controls-wrapper {
  display: flex;
  justify-content: center;
  gap: 12px;
  background: rgba(10, 10, 20, 0.85);
  padding: 12px 20px;
  border-radius: 25px;
  border: 2px solid rgba(52, 152, 219, 0.3);
  backdrop-filter: blur(10px);
  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
}

.btn-control {
  background: rgba(52, 152, 219, 0.9);
  color: #fff;
  border: none;
  width: 55px;
  height: 55px;
  border-radius: 50%;
  font-size: 1.5rem;
  cursor: pointer;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: normal;
  padding: 0;
}

.btn-control:active {
  transform: scale(0.92);
}

.btn-control:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(52, 152, 219, 0.5);
}

#exit-btn {
  position: fixed;
  top: 15px;
  right: 15px;
  background: rgba(231, 76, 60, 0.9);
  color: #fff;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  border: none;
  font-size: 1.4rem;
  z-index: 1002;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
  cursor: pointer;
  display: none;
  transition: all 0.2s;
}

#exit-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 20px rgba(231, 76, 60, 0.5);
}

#exit-btn:active {
  transform: scale(0.95);
}

#preview {
  max-width: 100%;
  max-height: 150px;
  margin-top: 10px;
  border-radius: 8px;
  display: none;
}

.info-section {
  background: rgba(255, 255, 255, 0.1);
  padding: 15px;
  border-radius: 10px;
  margin: 15px;
  max-width: 450px;
  font-size: 0.85rem;
  line-height: 1.6;
  text-align: left;
}

.info-section a {
  color: #3498db;
  text-decoration: underline;
  font-weight: bold;
}

.info-section a:hover {
  color: #2980b9;
}

@media (max-width: 480px) {
  .btn-control {
    width: 50px;
    height: 50px;
    font-size: 1.4rem;
  }
  
  #exit-btn {
    width: 45px;
    height: 45px;
  }
  
  .btn-start {
    min-width: 240px;
    padding: 14px 35px;
    font-size: 1.2rem;
  }
}
</style>
</head>
<body>

<!-- PANTALLA INICIAL -->
<div id="init-screen">
  <div class="init-logo">üî¨</div>
  <h1 class="init-title">WILL AR</h1>
  <p class="init-desc">
    Laboratorio Matem√°tico de Realidad Aumentada<br>
    Apunta tu c√°mara al marcador HIRO para ver figuras 3D
  </p>
  <div id="https-warning">
    ‚ö†Ô∏è Requiere HTTPS para funcionar en m√≥viles
  </div>
  <button class="btn-start" id="start-btn">‚úÖ INICIAR C√ÅMARA</button>
  <div class="info-section">
    <strong>üìå Instrucciones:</strong><br><br>
    1. Haz clic en "INICIAR C√ÅMARA"<br>
    2. <strong>Permite el permiso</strong> cuando el navegador lo solicite<br>
    3. Configura tu figura y textura<br>
    4. Descarga e imprime el <strong>marcador HIRO</strong><br>
    5. Apunta la c√°mara al marcador<br><br>
    <a href="https://raw.githack.com/AR-js-org/AR.js/master/data/images/hiro.png" target="_blank">
      üëâ Descargar marcador HIRO (A4)
    </a>
  </div>
</div>

<!-- MEN√ö DE CONFIGURACI√ìN -->
<div id="menu-overlay">
  <div class="card">
    <h2 style="color: #3498db; margin-bottom: 15px;">‚öôÔ∏è CONFIGURACI√ìN</h2>
    
    <label>üé® Textura (Opcional)</label>
    <div class="file-input-wrapper">
      <input type="file" id="imgUpload" accept="image/jpeg,image/png,image/jpg">
      <label for="imgUpload" class="file-input-label">üìÅ Seleccionar Imagen</label>
    </div>
    <img id="preview" alt="Vista previa">
    
    <label>üî∑ Figura Geom√©trica</label>
    <select id="figura">
      <option value="box">üì¶ Cubo</option>
      <option value="sphere">‚öΩ Esfera</option>
      <option value="cylinder">üõ¢Ô∏è Cilindro</option>
      <option value="cone">üî∫ Cono</option>
      <option value="torus">üç© Toroide</option>
    </select>
    
    <button class="btn-gen" onclick="generarConfig()">‚öôÔ∏è CONFIGURAR</button>
    <button class="btn-start-ar" id="btn-iniciar-ar" onclick="iniciarAR()">üöÄ INICIAR AR</button>
    <button class="btn-back" onclick="volverInicio()">üîô Volver</button>
  </div>
</div>

<!-- ESCENA AR -->
<div id="ar-scene-container"></div>

<!-- CONTROLES -->
<div id="controls">
  <div class="controls-wrapper">
    <button class="btn-control" id="btn-info" onclick="alert('Informaci√≥n de la figura')" title="Informaci√≥n">‚ÑπÔ∏è</button>
    <button class="btn-control" id="btn-rotate" onclick="toggleRotacion()" title="Rotaci√≥n">‚è∏Ô∏è</button>
    <button class="btn-control" id="btn-exit" onclick="salirAR()" title="Salir">‚úï</button>
  </div>
</div>

<!-- BOT√ìN DE SALIDA -->
<button id="exit-btn" onclick="salirAR()">‚úï</button>

<!-- STATUS DE C√ÅMARA -->
<div id="camera-status">üîç Buscando marcador HIRO...</div>

<script>
let texturaData = null;
let figuraSeleccionada = "box";
let arActivo = false;
let rotacionActiva = true;
let cameraStream = null;
let sceneLoaded = false;

// ===== VERIFICACI√ìN HTTPS =====
window.addEventListener('load', () => {
  const esHTTPS = location.protocol === 'https:';
  const esLocalhost = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
  
  if (!esHTTPS && !esLocalhost) {
    document.getElementById('https-warning').style.display = 'block';
  }
});

// ===== SOLICITAR PERMISOS DE C√ÅMARA =====
document.getElementById('start-btn').addEventListener('click', async () => {
  const esHTTPS = location.protocol === 'https:';
  const esLocalhost = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
  
  if (!esHTTPS && !esLocalhost) {
    alert('‚ö†Ô∏è Esta aplicaci√≥n requiere HTTPS para acceder a la c√°mara en dispositivos m√≥viles.\n\nSoluciones:\n‚Ä¢ Usa localhost para pruebas\n‚Ä¢ Despliega en GitHub Pages (https://)\n‚Ä¢ Usa servidor con SSL');
    return;
  }
  
  try {
    console.log('üì∑ Solicitando permisos de c√°mara...');
    
    // Solicitar permisos EXPL√çCITAMENTE antes de iniciar AR
    const stream = await navigator.mediaDevices.getUserMedia({
      video: {
        facingMode: 'environment', // C√°mara trasera
        width: { ideal: 1280 },
        height: { ideal: 720 },
        frameRate: { ideal: 30 }
      }
    });
    
    // Guardar el stream para usarlo despu√©s
    cameraStream = stream;
    
    console.log('‚úÖ Permisos de c√°mara concedidos');
    
    // Detener el stream temporalmente (AR.js lo reiniciar√°)
    stream.getTracks().forEach(track => track.stop());
    
    // Ocultar pantalla inicial y mostrar men√∫
    document.getElementById('init-screen').classList.add('hidden');
    
    setTimeout(() => {
      document.getElementById('menu-overlay').style.display = 'flex';
    }, 400);
    
  } catch (err) {
    console.error('‚ùå Error al solicitar permisos:', err);
    
    let mensaje = 'Error al acceder a la c√°mara:\n\n';
    
    switch(err.name) {
      case 'NotAllowedError':
        mensaje += '‚Ä¢ Permiso denegado por el usuario\n';
        mensaje += '‚Ä¢ Soluci√≥n: Recarga y permite el permiso cuando el navegador lo solicite';
        break;
      case 'NotFoundError':
        mensaje += '‚Ä¢ No se encontr√≥ c√°mara en este dispositivo\n';
        mensaje += '‚Ä¢ Soluci√≥n: Verifica que la c√°mara est√© conectada y funcione';
        break;
      case 'NotReadableError':
        mensaje += '‚Ä¢ La c√°mara est√° en uso por otra aplicaci√≥n\n';
        mensaje += '‚Ä¢ Soluci√≥n: Cierra otras apps que usen la c√°mara';
        break;
      case 'SecurityError':
        mensaje += '‚Ä¢ Bloqueado por seguridad del navegador\n';
        mensaje += '‚Ä¢ Soluci√≥n: Usa conexi√≥n HTTPS segura';
        break;
      default:
        mensaje += `‚Ä¢ Error: ${err.name}\n`;
        mensaje += '‚Ä¢ Soluci√≥n: Revisa la consola del navegador para m√°s detalles';
    }
    
    mensaje += '\n\nüì± iOS: Configuraci√≥n > Safari > C√°mara: Permitir\nü§ñ Android: Configuraci√≥n > Apps > Chrome > Permisos > C√°mara: Permitir';
    
    alert(mensaje);
  }
});

// ===== CARGA DE TEXTURA =====
document.getElementById('imgUpload').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (!file) return;
  
  // Validar tama√±o
  if (file.size > 5 * 1024 * 1024) {
    alert('‚ö†Ô∏è La imagen es muy grande. M√°ximo permitido: 5MB');
    this.value = '';
    return;
  }
  
  // Validar tipo
  if (!file.type.match('image/(jpg|jpeg|png)')) {
    alert('‚ö†Ô∏è Solo se permiten im√°genes JPG o PNG');
    this.value = '';
    return;
  }
  
  const reader = new FileReader();
  
  reader.onload = function(event) {
    texturaData = event.target.result;
    document.getElementById('preview').src = texturaData;
    document.getElementById('preview').style.display = 'block';
    console.log('‚úÖ Textura cargada exitosamente');
  };
  
  reader.onerror = function() {
    alert('‚ùå Error al leer el archivo de imagen');
    e.target.value = '';
  };
  
  reader.readAsDataURL(file);
});

// ===== GENERAR CONFIGURACI√ìN =====
function generarConfig() {
  figuraSeleccionada = document.getElementById('figura').value;
  
  // Mostrar bot√≥n de inicio
  document.getElementById('btn-iniciar-ar').style.display = 'block';
  
  console.log('‚úÖ Configuraci√≥n generada:', figuraSeleccionada);
}

// ===== INICIAR REALIDAD AUMENTADA =====
async function iniciarAR() {
  if (!cameraStream) {
    alert('‚ö†Ô∏è Primero permite el acceso a la c√°mara');
    return;
  }
  
  console.log('üé¨ Iniciando Realidad Aumentada...');
  
  // Ocultar men√∫
  document.getElementById('menu-overlay').style.display = 'none';
  
  // Construir escena AR DIN√ÅMICAMENTE
  construirEscenaAR();
  
  // Mostrar contenedores
  document.getElementById('ar-scene-container').style.display = 'block';
  document.getElementById('controls').style.display = 'block';
  document.getElementById('exit-btn').style.display = 'block';
  document.getElementById('camera-status').style.display = 'block';
  
  arActivo = true;
  
  // Esperar inicializaci√≥n de la escena
  await new Promise(resolve => setTimeout(resolve, 1200));
  
  // Crear figura 3D
  crearFigura3D();
  
  // Configurar eventos de marcador
  configurarEventosMarcador();
  
  console.log('üöÄ AR iniciado correctamente');
}

// ===== CONSTRUIR ESCENA AR =====
function construirEscenaAR() {
  const container = document.getElementById('ar-scene-container');
  
  // HTML de la escena con configuraci√≥n CORRECTA de c√°mara
  container.innerHTML = `
    <a-scene
      embedded
      arjs="sourceType: webcam;
             sourceWidth: 1280;
             sourceHeight: 720;
             displayWidth: 1280;
             displayHeight: 720;
             debugUIEnabled: false;
             detectionMode: mono_and_matrix;
             matrixCodeType: 3x3;
             maxDetectionRate: 60;
             canvasWidth: 1280;
             canvasHeight: 720;"
      vr-mode-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true;
                 precision: medium;
                 antialias: true;"
      loading-screen="enabled: false"
      device-orientation-permission-ui="enabled: false"
      style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
      
      <a-assets timeout="40000">
        <img id="textura-asset" crossorigin="anonymous" src="${texturaData || ''}">
        <img id="textura-defecto" 
             src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@dev/examples/textures/cube/skyboxsun25deg/px.jpg"
             crossorigin="anonymous">
      </a-assets>
      
      <!-- Iluminaci√≥n -->
      <a-entity light="type: ambient; color: #FFF; intensity: 0.8"></a-entity>
      <a-entity light="type: directional; color: #FFF; intensity: 0.6" position="1 2 1"></a-entity>
      
      <!-- Marcador HIRO -->
      <a-marker
        preset="hiro"
        id="hiro-marker"
        smooth="true"
        smoothCount="10"
        smoothTolerance="0.01"
        smoothThreshold="5">
        
        <a-entity id="contenedor-principal" position="0 0 0"></a-entity>
        
      </a-marker>
      
      <!-- C√°mara -->
      <a-entity camera position="0 1.6 0"></a-entity>
    </a-scene>
  `;
  
  sceneLoaded = true;
}

// ===== CREAR FIGURA 3D =====
function crearFigura3D() {
  const contenedor = document.getElementById('contenedor-principal');
  if (!contenedor) {
    console.error('‚ùå Contenedor no encontrado');
    return;
  }
  
  // Limpiar contenedor
  contenedor.innerHTML = '';
  
  // Crear modelo principal
  const modelo = document.createElement('a-entity');
  modelo.setAttribute('id', 'modelo-3d');
  modelo.setAttribute('position', '0 0.5 0');
  
  // Configuraci√≥n geom√©trica
  let geoParams = '';
  let rotation = '0 45 0';
  
  switch(figuraSeleccionada) {
    case 'box':
      geoParams = 'primitive: box; width: 1; height: 1; depth: 1';
      break;
    case 'sphere':
      geoParams = 'primitive: sphere; radius: 0.5; segmentsWidth: 32; segmentsHeight: 32';
      rotation = '0 0 0';
      break;
    case 'cylinder':
      geoParams = 'primitive: cylinder; radius: 0.5; height: 1.5; segmentsRadial: 24';
      break;
    case 'cone':
      geoParams = 'primitive: cone; radiusBottom: 0.5; radiusTop: 0; height: 1.5; segmentsRadial: 16';
      break;
    case 'torus':
      geoParams = 'primitive: torus; radius: 0.5; radiusTubular: 0.15; segmentsRadial: 24; segmentsTubular: 16';
      break;
    default:
      geoParams = 'primitive: box; width: 1; height: 1; depth: 1';
  }
  
  modelo.setAttribute('geometry', geoParams);
  modelo.setAttribute('rotation', rotation);
  
  // Material con textura o por defecto
  const materialParams = texturaData
    ? `src: #textura-asset; metalness: 0.3; roughness: 0.5; side: double`
    : `color: #4ECDC4; metalness: 0.3; roughness: 0.5; side: double`;
  
  modelo.setAttribute('material', materialParams);
  
  // Animaci√≥n de rotaci√≥n
  if (rotacionActiva) {
    modelo.setAttribute('animation', 'property: rotation; to: 0 360 0; dur: 8000; loop: true; easing: linear');
  }
  
  // Wireframe gu√≠a
  const wireframe = document.createElement('a-entity');
  wireframe.setAttribute('id', 'wireframe-guia');
  wireframe.setAttribute('geometry', geoParams);
  wireframe.setAttribute('material', 'wireframe: true; color: #FFE66D; opacity: 0.8; side: double');
  wireframe.setAttribute('scale', '1.05 1.05 1.05');
  wireframe.setAttribute('rotation', rotation);
  wireframe.setAttribute('position', '0 0.5 0');
  
  contenedor.appendChild(modelo);
  contenedor.appendChild(wireframe);
  
  console.log('‚úÖ Figura 3D creada:', figuraSeleccionada);
}

// ===== CONFIGURAR EVENTOS DE MARCADOR =====
function configurarEventosMarcador() {
  const marker = document.querySelector('#hiro-marker');
  if (!marker) {
    console.error('‚ùå Marcador no encontrado');
    return;
  }
  
  marker.addEventListener('markerFound', () => {
    console.log('‚úÖ ¬°Marcador HIRO detectado!');
    
    const status = document.getElementById('camera-status');
    status.textContent = '‚úÖ ¬°Objeto 3D visible!';
    status.className = 'status-ok';
    
    // Ocultar mensaje despu√©s de 3 segundos
    setTimeout(() => {
      if (status) {
        status.style.display = 'none';
      }
    }, 3000);
  });
  
  marker.addEventListener('markerLost', () => {
    console.log('üîç Marcador perdido');
    
    const status = document.getElementById('camera-status');
    if (status) {
      status.textContent = 'üîç Buscando marcador HIRO...';
      status.className = '';
      status.style.display = 'block';
    }
  });
}

// ===== FUNCIONES DE CONTROL =====
function toggleRotacion() {
  rotacionActiva = !rotacionActiva;
  const modelo = document.getElementById('modelo-3d');
  const btn = document.getElementById('btn-rotate');
  
  if (modelo) {
    if (rotacionActiva) {
      modelo.setAttribute('animation', 'property: rotation; to: 0 360 0; dur: 8000; loop: true; easing: linear');
      btn.innerHTML = '‚è∏Ô∏è';
    } else {
      modelo.removeAttribute('animation');
      btn.innerHTML = '‚ñ∂Ô∏è';
    }
  }
}

function salirAR() {
  if (confirm('¬øVolver al men√∫ principal?')) {
    // Limpiar recursos de c√°mara
    try {
      const video = document.querySelector('video');
      if (video && video.srcObject) {
        video.srcObject.getTracks().forEach(track => track.stop());
        video.srcObject = null;
      }
    } catch (e) {
      console.log('Info: No se encontr√≥ stream de c√°mara');
    }
    
    // Recargar aplicaci√≥n
    location.reload();
  }
}

function volverInicio() {
  document.getElementById('menu-overlay').style.display = 'none';
  setTimeout(() => {
    document.getElementById('init-screen').classList.remove('hidden');
  }, 400);
}

// ===== BLOQUEAR GESTOS PROBLEM√ÅTICOS =====
['gesturestart', 'gesturechange', 'gestureend'].forEach(event => {
  document.addEventListener(event, e => e.preventDefault(), { passive: false });
});

document.addEventListener('touchmove', e => {
  if (e.touches.length > 1) e.preventDefault();
}, { passive: false });

console.log('‚úÖ WILL AR - Sistema inicializado correctamente');
</script>

</body>
</html>
