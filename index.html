<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="description" content="WILL AR - Laboratorio Matem√°tico de Realidad Aumentada para educaci√≥n STEM">
  <meta name="author" content="Sistema Educativo WILL">
  <meta name="theme-color" content="#2c3e50">
  <title>üî¨ WILL AR - Laboratorio Matem√°tico Avanzado</title>
  
  <!-- Fuentes optimizadas para legibilidad en m√≥viles -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto+Mono:wght@300;400&display=swap" rel="stylesheet">
  
  <!-- LIBRER√çAS ESTABLES Y ACTUALIZADAS -->
  <!-- A-Frame 1.4.2: √öltima versi√≥n estable con mejor soporte m√≥vil -->
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  
  <!-- AR.js 3.4.4: Versi√≥n corregida con fixes para iOS/Android -->
  <script src="https://cdn.jsdelivr.net/npm/ar-js-org@3.4.4/aframe/build/aframe-ar.js"></script>
  
  <style>
    /* ===== VARIABLES CSS GLOBALES ===== */
    :root {
      --primary: #3498db;
      --primary-dark: #2980b9;
      --secondary: #e74c3c;
      --secondary-dark: #c0392b;
      --success: #27ae60;
      --success-dark: #219653;
      --warning: #f39c12;
      --warning-dark: #d35400;
      --info: #9b59b6;
      --info-dark: #8e44ad;
      --light: #ecf0f1;
      --dark: #2c3e50;
      --gray: #95a5a6;
      --black: #0a0a0f;
      --white: #ffffff;
      --transition-fast: 0.2s ease-in-out;
      --transition-normal: 0.3s ease-in-out;
      --transition-slow: 0.5s ease-in-out;
      --shadow-sm: 0 2px 8px rgba(0,0,0,0.15);
      --shadow-md: 0 4px 15px rgba(0,0,0,0.25);
      --shadow-lg: 0 10px 30px rgba(0,0,0,0.4);
      --border-radius-sm: 8px;
      --border-radius-md: 15px;
      --border-radius-lg: 25px;
      --font-main: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      --font-mono: 'Roboto Mono', monospace;
    }

    /* ===== RESET Y BASE ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    html {
      font-size: 16px;
      height: 100%;
      touch-action: manipulation;
    }

    body {
      margin: 0;
      overflow: hidden;
      font-family: var(--font-main);
      background-color: var(--black);
      width: 100vw;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      color: var(--light);
      -webkit-text-size-adjust: 100%;
      text-size-adjust: 100%;
      overscroll-behavior: none;
    }

    /* ===== PANTALLA DE INICIO ===== */
    #init-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1e 100%);
      z-index: 9999;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      padding: 20px;
      text-align: center;
      transition: opacity var(--transition-normal);
    }

    #init-screen.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .init-logo {
      font-size: 4rem;
      margin-bottom: 20px;
      background: linear-gradient(135deg, var(--primary), #1abc9c);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      font-weight: 800;
      letter-spacing: -1px;
      text-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
    }

    .init-title {
      font-size: 2.4rem;
      margin-bottom: 12px;
      color: var(--light);
      font-weight: 700;
      letter-spacing: -0.5px;
    }

    .init-subtitle {
      font-size: 1.4rem;
      color: var(--primary);
      font-weight: 300;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    .init-desc {
      font-size: 1.15rem;
      color: #bdc3c7;
      max-width: 85%;
      margin: 15px 0 25px 0;
      line-height: 1.7;
    }

    .btn-start {
      background: linear-gradient(135deg, var(--success-dark) 0%, var(--success) 100%);
      color: white;
      border: none;
      padding: 20px 50px;
      font-size: 1.4rem;
      border-radius: var(--border-radius-md);
      cursor: pointer;
      font-weight: 700;
      box-shadow: 0 8px 25px rgba(46, 204, 113, 0.45);
      transition: all var(--transition-normal);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      min-width: 300px;
      letter-spacing: 0.5px;
      margin-top: 10px;
    }

    .btn-start:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 30px rgba(46, 204, 113, 0.6);
    }

    .btn-start:active {
      transform: scale(0.97) translateY(1px);
      box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4);
    }

    .btn-start:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    #https-warning {
      background: rgba(231, 76, 60, 0.15);
      color: #e74c3c;
      padding: 20px;
      text-align: center;
      font-weight: 600;
      border-radius: var(--border-radius-md);
      margin: 25px 0;
      border: 2px solid rgba(231, 76, 60, 0.3);
      max-width: 90%;
      font-size: 1.15rem;
      line-height: 1.6;
      box-shadow: 0 4px 15px rgba(231, 76, 60, 0.15);
      display: none;
    }

    .warning-title {
      font-size: 1.3rem;
      margin-bottom: 10px;
      color: #e74c3c;
    }

    .warning-solutions {
      background: rgba(0,0,0,0.4);
      padding: 15px;
      border-radius: var(--border-radius-sm);
      margin-top: 15px;
      font-size: 1rem;
      text-align: left;
      border-left: 4px solid var(--warning);
      line-height: 1.8;
    }

    .download-link {
      display: inline-block;
      background: rgba(52, 152, 219, 0.2);
      color: var(--primary);
      text-decoration: none;
      padding: 14px 28px;
      border-radius: var(--border-radius-md);
      margin-top: 20px;
      font-weight: 600;
      transition: all var(--transition-normal);
      border: 2px solid rgba(52, 152, 219, 0.4);
      font-size: 1.05rem;
    }

    .download-link:hover {
      background: rgba(52, 152, 219, 0.35);
      transform: translateY(-2px);
      border-color: var(--primary);
    }

    .download-link:active {
      transform: translateY(1px);
    }

    /* ===== MEN√ö DE CONFIGURACI√ìN ===== */
    #menu-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #2c3e50 0%, #0a0a15 100%);
      z-index: 9998;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      overflow-y: auto;
      padding: 25px 20px 30px;
      color: white;
      transition: transform var(--transition-slow) cubic-bezier(0.23, 1, 0.32, 1);
    }

    .header-section {
      text-align: center;
      margin-bottom: 25px;
      width: 100%;
      padding: 0 10px;
    }

    .app-logo-menu {
      font-size: 2.6rem;
      background: linear-gradient(135deg, var(--primary), #1abc9c);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      font-weight: 800;
      letter-spacing: -1px;
      margin-bottom: 8px;
      text-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
    }

    .app-subtitle-menu {
      font-size: 1.25rem;
      color: #3498db;
      font-weight: 300;
      letter-spacing: 1px;
      margin-bottom: 5px;
    }

    .app-tagline-menu {
      font-size: 1.05rem;
      color: #95a5a6;
      font-style: italic;
      max-width: 90%;
      margin: 0 auto;
      line-height: 1.6;
    }

    .card-config {
      background: rgba(255,255,255,0.08);
      backdrop-filter: blur(12px);
      padding: 30px;
      border-radius: var(--border-radius-lg);
      width: 96%;
      max-width: 450px;
      text-align: center;
      border: 1px solid rgba(255,255,255,0.12);
      margin-bottom: 25px;
      box-shadow: var(--shadow-lg);
      transition: transform var(--transition-normal), box-shadow var(--transition-normal);
    }

    .card-config:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 40px rgba(0,0,0,0.6);
      border-color: rgba(52, 152, 219, 0.3);
    }

    .section-title-config {
      font-size: 1.5rem;
      color: var(--primary);
      margin-bottom: 22px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    .section-title-config::before,
    .section-title-config::after {
      content: "";
      display: block;
      height: 2.5px;
      flex: 1;
      background: linear-gradient(to right, transparent, rgba(52, 152, 219, 0.6));
    }

    label.config-label {
      display: block;
      text-align: left;
      margin: 20px 0 12px;
      color: var(--light);
      font-size: 1.1rem;
      font-weight: 500;
      position: relative;
      padding-left: 30px;
    }

    label.config-label::before {
      content: "‚Ä¢";
      position: absolute;
      left: 0;
      top: 0;
      font-size: 2rem;
      color: var(--primary);
      line-height: 1;
    }

    select.config-select {
      width: 100%;
      padding: 16px 20px;
      border-radius: var(--border-radius-md);
      border: 2px solid rgba(255,255,255,0.15);
      background: rgba(0,0,0,0.35);
      color: white;
      font-size: 1.1rem;
      outline: none;
      transition: all var(--transition-fast);
      font-family: var(--font-main);
      appearance: none;
      background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%233498db' d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 18px center;
      background-size: 22px;
    }

    select.config-select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.25);
    }

    option {
      background: #2c3e50;
      color: white;
      padding: 10px;
    }

    button.config-btn {
      width: 100%;
      padding: 18px;
      margin-top: 20px;
      border-radius: var(--border-radius-md);
      border: none;
      font-size: 1.25rem;
      font-weight: 700;
      cursor: pointer;
      transition: all var(--transition-normal);
      box-shadow: var(--shadow-md);
      position: relative;
      z-index: 10;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    button.config-btn:active {
      transform: scale(0.97);
      box-shadow: 0 3px 10px rgba(0,0,0,0.3);
    }

    button.config-btn:focus {
      outline: none;
      box-shadow: 0 0 0 4px rgba(255,255,255,0.3);
    }

    .btn-config {
      background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
      color: white;
      box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
    }

    .btn-config:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(52, 152, 219, 0.55);
    }

    .btn-start-ar {
      background: linear-gradient(135deg, var(--success-dark) 0%, var(--success) 100%);
      color: white;
      font-size: 1.45rem;
      display: none;
      margin-top: 28px;
      padding: 20px;
      box-shadow: 0 8px 25px rgba(46, 204, 113, 0.45);
    }

    .btn-start-ar:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 30px rgba(46, 204, 113, 0.6);
    }

    .btn-back {
      background: linear-gradient(135deg, var(--secondary-dark) 0%, var(--secondary) 100%);
      color: white;
      padding: 15px 28px;
      font-size: 1.1rem;
      width: auto;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 150px;
      box-shadow: 0 5px 18px rgba(231, 76, 60, 0.4);
      margin-top: 18px;
      border-radius: var(--border-radius-md);
    }

    .btn-back:hover {
      transform: translateY(-2px);
      box-shadow: 0 7px 22px rgba(231, 76, 60, 0.55);
    }

    .info-section-config {
      background: rgba(255,255,255,0.08);
      backdrop-filter: blur(10px);
      padding: 28px;
      border-radius: var(--border-radius-lg);
      margin: 28px 15px;
      max-width: 480px;
      font-size: 0.98rem;
      line-height: 1.8;
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: var(--shadow-md);
    }

    .info-section-config h3 {
      color: var(--primary);
      margin-bottom: 18px;
      font-size: 1.4rem;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .info-section-config ul {
      padding-left: 28px;
      margin: 18px 0;
      color: var(--light);
    }

    .info-section-config li {
      margin-bottom: 12px;
      position: relative;
    }

    .info-section-config li::before {
      content: "‚úì";
      color: var(--success);
      position: absolute;
      left: -28px;
      font-weight: bold;
      font-size: 1.2rem;
    }

    /* ===== ESCENA AR (95% PANTALLA) ===== */
    #ar-scene-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      display: none;
    }

    /* ===== STATUS DE C√ÅMARA ===== */
    #camera-status {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(10, 10, 20, 0.94);
      color: #fff;
      padding: 14px 32px;
      border-radius: 50px;
      font-size: 1.2rem;
      z-index: 1001;
      display: none;
      border: 3px solid var(--primary);
      box-shadow: 0 6px 25px rgba(0,0,0,0.6);
      font-weight: 700;
      backdrop-filter: blur(12px);
      transition: all var(--transition-normal);
      max-width: 92%;
      text-align: center;
      line-height: 1.5;
    }

    .status-ok {
      color: var(--success) !important;
      border-color: var(--success);
      box-shadow: 0 6px 25px rgba(39, 174, 96, 0.45);
    }

    .status-searching {
      color: var(--warning) !important;
      border-color: var(--warning);
      animation: pulse-warning 2s infinite;
    }

    @keyframes pulse-warning {
      0%, 100% { box-shadow: 0 0 0 0 rgba(243, 156, 18, 0.4); }
      50% { box-shadow: 0 0 0 8px rgba(243, 156, 18, 0); }
    }

    /* ===== CONTROLES MINIMALISTAS (INFERIOR) ===== */
    #ar-controls {
      position: fixed;
      bottom: 14px;
      left: 0;
      width: 100%;
      z-index: 1000;
      text-align: center;
      display: none;
    }

    .controls-wrapper {
      display: inline-flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      background: rgba(10, 10, 25, 0.92);
      padding: 12px 20px;
      border-radius: 30px;
      border: 2px solid rgba(52, 152, 219, 0.4);
      backdrop-filter: blur(15px);
      box-shadow: 0 6px 25px rgba(0,0,0,0.55);
      max-width: 420px;
      margin: 0 auto;
    }

    .btn-control {
      background: rgba(52, 152, 219, 0.92);
      color: white;
      border: none;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      font-size: 1.65rem;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0,0,0,0.45);
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: normal;
      padding: 0;
      position: relative;
      z-index: 10;
    }

    .btn-control:hover {
      transform: translateY(-3px);
      box-shadow: 0 7px 22px rgba(52, 152, 219, 0.6);
    }

    .btn-control:active {
      transform: scale(0.93) translateY(1px);
      box-shadow: 0 3px 10px rgba(0,0,0,0.4);
    }

    .btn-control:focus {
      outline: 3px solid rgba(255,255,255,0.3);
    }

    .btn-rotate {
      background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
      box-shadow: 0 4px 15px rgba(155, 89, 182, 0.45);
    }

    .btn-rotate:hover {
      box-shadow: 0 7px 22px rgba(155, 89, 182, 0.6);
    }

    .btn-scale-down {
      background: linear-gradient(135deg, #f39c12 0%, #d35400 100%);
      box-shadow: 0 4px 15px rgba(243, 156, 18, 0.45);
    }

    .btn-scale-down:hover {
      box-shadow: 0 7px 22px rgba(243, 156, 18, 0.6);
    }

    .btn-scale-up {
      background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
      box-shadow: 0 4px 15px rgba(46, 204, 113, 0.45);
    }

    .btn-scale-up:hover {
      box-shadow: 0 7px 22px rgba(46, 204, 113, 0.6);
    }

    .btn-measure {
      background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      box-shadow: 0 4px 15px rgba(52, 152, 219, 0.45);
    }

    .btn-measure:hover {
      box-shadow: 0 7px 22px rgba(52, 152, 219, 0.6);
    }

    .btn-exit-control {
      background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
      box-shadow: 0 4px 15px rgba(231, 76, 60, 0.45);
    }

    .btn-exit-control:hover {
      box-shadow: 0 7px 22px rgba(231, 76, 60, 0.6);
    }

    /* ===== BOT√ìN DE SALIDA (ESQUINA SUPERIOR DERECHA) ===== */
    #exit-btn {
      position: fixed;
      top: 16px;
      right: 16px;
      background: rgba(231, 76, 60, 0.94);
      color: white;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: none;
      font-size: 1.5rem;
      z-index: 1002;
      box-shadow: 0 5px 20px rgba(0,0,0,0.5);
      cursor: pointer;
      display: none;
      transition: all var(--transition-fast);
    }

    #exit-btn:hover {
      transform: scale(1.08);
      box-shadow: 0 8px 25px rgba(231, 76, 60, 0.65);
    }

    #exit-btn:active {
      transform: scale(0.94);
    }

    /* ===== PANEL DE MEDICIONES ===== */
    #measurements-panel {
      position: fixed;
      bottom: 85px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(52, 152, 219, 0.94);
      color: white;
      padding: 14px 25px;
      border-radius: 25px;
      font-size: 1.15rem;
      font-weight: 700;
      z-index: 999;
      display: none;
      box-shadow: 0 6px 25px rgba(0,0,0,0.5);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255,255,255,0.2);
      max-width: 90%;
      text-align: center;
      line-height: 1.5;
    }

    .measure-value {
      color: #fff;
      font-size: 1.35rem;
      font-weight: 800;
      display: inline-block;
      min-width: 85px;
    }

    .measure-label {
      font-size: 0.95rem;
      color: rgba(255,255,255,0.85);
      display: block;
      margin-top: 3px;
    }

    /* ===== ANIMACIONES ===== */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .animate-fade {
      animation: fadeIn 0.6s ease-out forwards;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .animate-float {
      animation: float 3s ease-in-out infinite;
    }

    /* ===== MEDIA QUERIES ===== */
    @media (max-width: 480px) {
      :root {
        font-size: 15px;
      }
      
      .init-logo {
        font-size: 3.2rem;
      }
      
      .init-title {
        font-size: 2rem;
      }
      
      .btn-start {
        min-width: 260px;
        padding: 18px 40px;
        font-size: 1.3rem;
      }
      
      .btn-control {
        width: 50px;
        height: 50px;
        font-size: 1.5rem;
      }
      
      #exit-btn {
        width: 46px;
        height: 46px;
        top: 14px;
        right: 14px;
      }
      
      #measurements-panel {
        padding: 12px 20px;
        font-size: 1.05rem;
      }
      
      .measure-value {
        font-size: 1.25rem;
        min-width: 75px;
      }
    }

    @media (min-width: 768px) {
      .card-config {
        max-width: 480px;
      }
      
      .btn-start {
        min-width: 320px;
      }
    }
  </style>
</head>
<body>
  <!-- PANTALLA DE INICIO CON INSTRUCCIONES EDUCATIVAS -->
  <div id="init-screen" aria-labelledby="init-heading">
    <div class="init-logo" aria-hidden="true">üî¨</div>
    <h1 id="init-heading" class="init-title">WILL AR</h1>
    <div class="init-subtitle">Laboratorio Matem√°tico Avanzado</div>
    <p class="init-desc">
      Explora geometr√≠a tridimensional en tiempo real con Realidad Aumentada educativa.<br>
      Apunta tu c√°mara al marcador HIRO para visualizar figuras matem√°ticas con regla graduada en cent√≠metros.
    </p>
    
    <div id="https-warning" role="alert" aria-live="assertive">
      <div class="warning-title">‚ö†Ô∏è REQUISITO DE SEGURIDAD</div>
      Los navegadores modernos solo permiten acceso a la c√°mara en conexiones seguras (HTTPS).<br><br>
      <div class="warning-solutions">
        ‚úÖ Soluciones:<br>
        ‚Ä¢ Usa <strong>localhost</strong> para pruebas locales (python -m http.server)<br>
        ‚Ä¢ Despliega en GitHub Pages, Netlify o Vercel (HTTPS autom√°tico)<br>
        ‚Ä¢ Servidor con certificado SSL v√°lido
      </div>
    </div>
    
    <button class="btn-start" id="start-btn" aria-label="Iniciar aplicaci√≥n y solicitar permisos de c√°mara para Realidad Aumentada">
      ‚úÖ INICIAR C√ÅMARA
    </button>
    
    <a href="https://raw.githack.com/AR-js-org/AR.js/master/data/images/hiro.png" 
       target="_blank" 
       class="download-link"
       aria-label="Descargar marcador HIRO para impresi√≥n en tama√±o A4">
      üëâ Descargar Marcador HIRO (Impresi√≥n A4 Recomendada)
    </a>
    
    <div class="info-section-config" style="margin-top: 30px;">
      <h3>üìå Instrucciones de Uso</h3>
      <ul>
        <li>1. Haz clic en "INICIAR C√ÅMARA" y permite el permiso cuando el navegador lo solicite</li>
        <li>2. Selecciona la figura geom√©trica que deseas visualizar</li>
        <li>3. Haz clic en "INICIAR REALIDAD AUMENTADA"</li>
        <li>4. Apunta la c√°mara de tu dispositivo al marcador HIRO impreso</li>
        <li>5. Usa los controles <strong>‚ûï</strong> y <strong>‚ûñ</strong> para modificar el tama√±o del objeto</li>
        <li>6. La regla graduada muestra mediciones en cent√≠metros sobre los tres ejes (X, Y, Z)</li>
        <li>7. Toca el bot√≥n <strong>üìè</strong> para mostrar/ocultar el panel de mediciones</li>
      </ul>
      <p style="margin-top: 15px; font-style: italic; color: #95a5a6;">
        üí° <strong>Consejo:</strong> Imprime el marcador en tama√±o A4 (100% sin ajustes) y col√≥calo sobre una superficie plana con buena iluminaci√≥n para mejor detecci√≥n.
      </p>
    </div>
  </div>

  <!-- MEN√ö DE CONFIGURACI√ìN -->
  <div id="menu-overlay" aria-labelledby="menu-title">
    <div class="header-section">
      <div class="app-logo-menu" id="menu-title">WILL AR</div>
      <div class="app-subtitle-menu">Configuraci√≥n del Laboratorio</div>
      <div class="app-tagline-menu">Selecciona tu figura geom√©trica para visualizar en 3D</div>
    </div>
    
    <div class="card-config">
      <div class="section-title-config">üî∑ Figura Geom√©trica</div>
      
      <label class="config-label" for="figura-select">Selecciona la figura que deseas explorar:</label>
      <select id="figura-select" class="config-select" aria-label="Seleccionar figura geom√©trica para visualizar en Realidad Aumentada">
        <option value="box">üì¶ Cubo (Hexaedro Regular)</option>
        <option value="sphere">‚öΩ Esfera</option>
        <option value="cylinder">üõ¢Ô∏è Cilindro Recto</option>
        <option value="cone">üî∫ Cono Recto</option>
        <option value="torus">üç© Toroide</option>
        <option value="tetrahedron">üî∫ Tetraedro Regular</option>
        <option value="dodecahedron">üíé Dodecaedro Regular</option>
        <option value="icosahedron">‚öΩ Icosaedro Regular</option>
        <option value="octahedron">üí† Octaedro Regular</option>
      </select>
      
      <button class="config-btn btn-config" id="btn-configurar" aria-label="Configurar figura seleccionada">
        ‚öôÔ∏è CONFIGURAR FIGURA
      </button>
      
      <button class="config-btn btn-start-ar" id="btn-iniciar-ar" aria-label="Iniciar experiencia de Realidad Aumentada">
        üöÄ INICIAR REALIDAD AUMENTADA
      </button>
      
      <button class="config-btn btn-back" id="btn-back" aria-label="Volver a la pantalla de inicio">
        üîô VOLVER AL INICIO
      </button>
    </div>
    
    <div class="info-section-config">
      <h3>üéØ Objetivos Educativos</h3>
      <ul>
        <li>Visualizar figuras geom√©tricas tridimensionales en contexto real</li>
        <li>Comprender las dimensiones espaciales (largo, ancho, altura) mediante medici√≥n directa</li>
        <li>Relacionar conceptos abstractos de geometr√≠a con objetos tangibles</li>
        <li>Desarrollar habilidades de percepci√≥n espacial y razonamiento matem√°tico</li>
        <li>Practicar c√°lculos de volumen y √°rea superficial con mediciones reales</li>
      </ul>
      <p style="margin-top: 18px; font-weight: 600; color: var(--primary);">
        üë®‚Äçüè´ <strong>Para docentes:</strong> Esta herramienta permite demostrar conceptos geom√©tricos de forma interactiva, facilitando la comprensi√≥n de estudiantes de grados 6¬∞ a 9¬∞.
      </p>
    </div>
  </div>

  <!-- ESCENA AR (INICIALMENTE OCULTA) -->
  <div id="ar-scene-container"></div>

  <!-- STATUS DE C√ÅMARA -->
  <div id="camera-status" aria-live="polite" aria-atomic="true">
    <span id="camera-status-text">üîç Buscando marcador HIRO para visualizar figura 3D...</span>
  </div>

  <!-- CONTROLES MINIMALISTAS -->
  <div id="ar-controls" aria-label="Controles de interacci√≥n con objeto 3D">
    <div class="controls-wrapper">
      <button class="btn-control btn-rotate" id="btn-rotate" title="Pausar/reanudar rotaci√≥n del objeto" aria-label="Pausar rotaci√≥n del objeto 3D">
        ‚è∏Ô∏è
      </button>
      <button class="btn-control btn-scale-down" id="btn-scale-down" title="Reducir tama√±o del objeto" aria-label="Reducir tama√±o del objeto 3D">
        ‚ûñ
      </button>
      <button class="btn-control btn-scale-up" id="btn-scale-up" title="Aumentar tama√±o del objeto" aria-label="Aumentar tama√±o del objeto 3D">
        ‚ûï
      </button>
      <button class="btn-control btn-measure" id="btn-measure" title="Mostrar/ocultar mediciones" aria-label="Mostrar mediciones en cent√≠metros">
        üìè
      </button>
      <button class="btn-control btn-exit-control" id="btn-exit-control" title="Salir de Realidad Aumentada" aria-label="Salir de la experiencia de Realidad Aumentada">
        ‚úï
      </button>
    </div>
  </div>

  <!-- BOT√ìN DE SALIDA R√ÅPIDA -->
  <button id="exit-btn" aria-label="Salir de Realidad Aumentada">‚úï</button>

  <!-- PANEL DE MEDICIONES EN TIEMPO REAL -->
  <div id="measurements-panel" aria-live="polite">
    <span class="measure-label">ALTURA (Y)</span> <span class="measure-value" id="measure-height">100</span>cm | 
    <span class="measure-label">ANCHO (X)</span> <span class="measure-value" id="measure-width">100</span>cm | 
    <span class="measure-label">PROF (Z)</span> <span class="measure-value" id="measure-depth">100</span>cm
  </div>

  <script>
    // ===== VARIABLES GLOBALES =====
    let figuraSeleccionada = "box";
    let arActivo = false;
    let rotacionActiva = true;
    let cameraStream = null;
    let sceneLoaded = false;
    let escalaActual = 1.0;
    let markerDetectado = false;
    let medicionesVisibles = false;

    // Dimensiones base para c√°lculos (en cm)
    const dimensionesBase = {
      box: { altura: 100, ancho: 100, profundidad: 100 },
      sphere: { altura: 100, ancho: 100, profundidad: 100 },
      cylinder: { altura: 150, ancho: 100, profundidad: 100 },
      cone: { altura: 150, ancho: 100, profundidad: 100 },
      torus: { altura: 60, ancho: 100, profundidad: 100 },
      tetrahedron: { altura: 120, ancho: 100, profundidad: 100 },
      dodecahedron: { altura: 110, ancho: 110, profundidad: 110 },
      icosahedron: { altura: 100, ancho: 100, profundidad: 100 },
      octahedron: { altura: 115, ancho: 100, profundidad: 100 }
    };

    // ===== INICIALIZACI√ìN DE LA APLICACI√ìN =====
    document.addEventListener('DOMContentLoaded', () => {
      console.log('üî¨ WILL AR - Laboratorio Matem√°tico Avanzado - Iniciando sistema...');
      
      // Configurar evento del bot√≥n de inicio
      document.getElementById('start-btn').addEventListener('click', solicitarPermisosCamara);
      
      // Configurar eventos del men√∫
      document.getElementById('btn-configurar').addEventListener('click', configurarFigura);
      document.getElementById('btn-iniciar-ar').addEventListener('click', iniciarAR);
      document.getElementById('btn-back').addEventListener('click', volverInicio);
      
      // Configurar controles AR
      document.getElementById('btn-rotate').addEventListener('click', toggleRotacion);
      document.getElementById('btn-scale-down').addEventListener('click', () => cambiarEscala(-0.2));
      document.getElementById('btn-scale-up').addEventListener('click', () => cambiarEscala(0.2));
      document.getElementById('btn-measure').addEventListener('click', toggleMediciones);
      document.getElementById('btn-exit-control').addEventListener('click', salirAR);
      document.getElementById('exit-btn').addEventListener('click', salirAR);
      
      // Bloquear gestos problem√°ticos
      bloquearGestosProblematicos();
      
      console.log('‚úÖ Sistema inicializado correctamente. Esperando interacci√≥n del usuario...');
    });

    // ===== SOLICITAR PERMISOS DE C√ÅMARA (CORREGIDO) =====
    async function solicitarPermisosCamara() {
      const esHTTPS = location.protocol === 'https:';
      const esLocalhost = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
      
      // Verificaci√≥n de seguridad
      if (!esHTTPS && !esLocalhost) {
        document.getElementById('https-warning').style.display = 'block';
        alert('‚ö†Ô∏è ADVERTENCIA DE SEGURIDAD:\n\nEsta aplicaci√≥n requiere conexi√≥n HTTPS para acceder a la c√°mara en dispositivos m√≥viles por pol√≠ticas de seguridad de los navegadores.\n\nSoluciones:\n‚Ä¢ Usa localhost para pruebas locales (ej: python -m http.server 8000)\n‚Ä¢ Despliega en GitHub Pages, Netlify o Vercel (HTTPS autom√°tico)\n‚Ä¢ Usa un servidor con certificado SSL v√°lido');
        return;
      }
      
      try {
        console.log('üì∑ Solicitando permisos expl√≠citos de c√°mara al usuario...');
        
        // SOLUCI√ìN CLAVE: Solicitar permisos EXPL√çCITAMENTE antes de iniciar AR
        // Esto es requerido por Chrome, Safari y Firefox modernos
        const constraints = {
          video: { 
            facingMode: 'environment', // Preferir c√°mara trasera
            width: { ideal: 1280 },
            height: { ideal: 720 },
            frameRate: { ideal: 30 }
          }
        };
        
        const stream = await navigator.mediaDevices.getUserMedia(constraints);
        cameraStream = stream;
        
        console.log('‚úÖ Permisos de c√°mara concedidos exitosamente');
        console.log('üìä Resoluci√≥n de c√°mara:', stream.getVideoTracks()[0].getSettings().width, 'x', stream.getVideoTracks()[0].getSettings().height);
        
        // Detener el stream temporalmente (AR.js lo reiniciar√° cuando construya la escena)
        stream.getTracks().forEach(track => track.stop());
        
        // Transici√≥n suave a men√∫ de configuraci√≥n
        document.getElementById('init-screen').classList.add('hidden');
        
        setTimeout(() => {
          document.getElementById('init-screen').style.display = 'none';
          document.getElementById('menu-overlay').style.display = 'flex';
          console.log('‚úÖ Men√∫ de configuraci√≥n mostrado');
        }, 400);
        
      } catch (err) {
        console.error('‚ùå Error cr√≠tico al solicitar permisos de c√°mara:', err);
        
        let mensaje = '‚ùå ERROR AL ACCEDER A LA C√ÅMARA:\n\n';
        
        // Mensajes espec√≠ficos seg√∫n el tipo de error
        switch(err.name) {
          case 'NotAllowedError':
            mensaje += '‚Ä¢ El usuario deneg√≥ el permiso de acceso a la c√°mara\n';
            mensaje += '‚Ä¢ Soluci√≥n: Recarga la p√°gina y permite el permiso cuando el navegador lo solicite';
            break;
          case 'NotFoundError':
            mensaje += '‚Ä¢ No se encontr√≥ ning√∫n dispositivo de c√°mara en este dispositivo\n';
            mensaje += '‚Ä¢ Soluci√≥n: Verifica que la c√°mara est√© conectada y funcione correctamente';
            break;
          case 'NotReadableError':
            mensaje += '‚Ä¢ La c√°mara est√° actualmente en uso por otra aplicaci√≥n\n';
            mensaje += '‚Ä¢ Soluci√≥n: Cierra otras aplicaciones que puedan estar usando la c√°mara (Zoom, Meet, etc.)';
            break;
          case 'SecurityError':
            mensaje += '‚Ä¢ El navegador bloque√≥ el acceso a la c√°mara por motivos de seguridad\n';
            mensaje += '‚Ä¢ Soluci√≥n: Aseg√∫rate de estar usando una conexi√≥n HTTPS segura o localhost';
            break;
          case 'AbortError':
            mensaje += '‚Ä¢ La operaci√≥n de acceso a la c√°mara fue abortada\n';
            mensaje += '‚Ä¢ Soluci√≥n: Intenta nuevamente o reinicia el navegador';
            break;
          default:
            mensaje += `‚Ä¢ Error desconocido: ${err.name}\n`;
            mensaje += '‚Ä¢ Soluci√≥n: Revisa la consola del navegador (F12) para m√°s detalles';
        }
        
        // Instrucciones espec√≠ficas por plataforma
        mensaje += '\n\nüì± INSTRUCCIONES POR PLATAFORMA:\n';
        mensaje += '‚Ä¢ iOS (iPhone/iPad): Configuraci√≥n ‚Üí Safari ‚Üí C√°mara: Permitir\n';
        mensaje += '‚Ä¢ Android (Chrome): Configuraci√≥n ‚Üí Apps ‚Üí Chrome ‚Üí Permisos ‚Üí C√°mara: Permitir\n';
        mensaje += '‚Ä¢ Desktop: Busca el √≠cono de c√°mara/candado en la barra de direcciones y permite el permiso';
        
        alert(mensaje);
      }
    }

    // ===== CONFIGURAR FIGURA SELECCIONADA =====
    function configurarFigura() {
      figuraSeleccionada = document.getElementById('figura-select').value;
      
      console.log(`‚úÖ Figura configurada: ${figuraSeleccionada}`);
      
      // Mostrar bot√≥n de inicio de AR
      document.getElementById('btn-iniciar-ar').style.display = 'block';
      
      // Feedback visual
      const btn = document.getElementById('btn-configurar');
      const originalText = btn.innerHTML;
      btn.innerHTML = '‚úÖ ¬°Configurado!';
      btn.style.background = 'linear-gradient(135deg, #27ae60 0%, #2ecc71 100%)';
      
      setTimeout(() => {
        btn.innerHTML = originalText;
        btn.style.background = 'linear-gradient(135deg, #2980b9 0%, #3498db 100%)';
      }, 1500);
    }

    // ===== INICIAR REALIDAD AUMENTADA (CORREGIDO) =====
    async function iniciarAR() {
      if (!cameraStream && !verificarEntornoSeguro()) {
        alert('‚ö†Ô∏è No se puede iniciar la c√°mara. Aseg√∫rate de haber permitido los permisos y estar en un entorno seguro (HTTPS o localhost).');
        return;
      }
      
      console.log('üé¨ Iniciando experiencia de Realidad Aumentada...');
      console.log(`üìä Figura seleccionada: ${figuraSeleccionada}`);
      console.log(`üìè Escala inicial: ${escalaActual}x`);
      
      // Ocultar men√∫ de configuraci√≥n
      document.getElementById('menu-overlay').style.display = 'none';
      
      // Construir escena AR DIN√ÅMICAMENTE (clave para que funcione)
      construirEscenaAR();
      
      // Mostrar elementos de AR
      document.getElementById('ar-scene-container').style.display = 'block';
      document.getElementById('ar-controls').style.display = 'block';
      document.getElementById('exit-btn').style.display = 'block';
      document.getElementById('camera-status').style.display = 'block';
      
      arActivo = true;
      
      // Esperar inicializaci√≥n de A-Frame
      await new Promise(resolve => setTimeout(resolve, 1200));
      
      if (!sceneLoaded) {
        sceneLoaded = true;
        
        // Crear figura 3D con regla graduada
        crearFigura3D();
        
        // Configurar eventos de detecci√≥n de marcador
        configurarEventosMarcador();
        
        console.log('üöÄ Realidad Aumentada iniciada correctamente');
      }
    }

    // ===== VERIFICAR ENTORNO SEGURO =====
    function verificarEntornoSeguro() {
      const esHTTPS = location.protocol === 'https:';
      const esLocalhost = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
      return esHTTPS || esLocalhost;
    }

    // ===== CONSTRUIR ESCENA AR DIN√ÅMICAMENTE =====
    function construirEscenaAR() {
      const container = document.getElementById('ar-scene-container');
      
      // HTML de la escena con configuraci√≥n CORRECTA y COMPLETA de c√°mara
      // Esta configuraci√≥n espec√≠fica es cr√≠tica para que AR.js funcione en m√≥viles
      container.innerHTML = `
        <a-scene
          embedded
          arjs="sourceType: webcam;
                 sourceWidth: 1280;
                 sourceHeight: 720;
                 displayWidth: 1280;
                 displayHeight: 720;
                 debugUIEnabled: false;
                 detectionMode: mono_and_matrix;
                 matrixCodeType: 3x3;
                 maxDetectionRate: 60;
                 canvasWidth: 1280;
                 canvasHeight: 720;
                 smoothingEnabled: true;
                 smoothingFactor: 0.5;"
          vr-mode-ui="enabled: false"
          renderer="logarithmicDepthBuffer: true;
                     precision: medium;
                     antialias: true;
                     physicallyCorrectLights: true;"
          loading-screen="enabled: false"
          device-orientation-permission-ui="enabled: false"
          style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
          
          <!-- Assets para texturas y fuentes -->
          <a-assets timeout="45000">
            <img id="textura-defecto" 
                 src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@dev/examples/textures/cube/skyboxsun25deg/px.jpg"
                 crossorigin="anonymous"
                 alt="Textura por defecto para objetos 3D">
          </a-assets>
          
          <!-- Iluminaci√≥n ambiental mejorada -->
          <a-entity light="type: ambient; color: #FFF; intensity: 0.85"></a-entity>
          <a-entity light="type: directional; color: #FFF; intensity: 0.75" position="1 2 1"></a-entity>
          <a-entity light="type: hemisphere; skyColor: #88baff; groundColor: #e0e0e0; intensity: 0.4" position="0 1 0"></a-entity>
          
          <!-- Marcador HIRO con optimizaciones de detecci√≥n -->
          <a-marker
            preset="hiro"
            id="hiro-marker"
            smooth="true"
            smoothCount="10"
            smoothTolerance="0.01"
            smoothThreshold="5"
            raycaster="objects: .clickable"
            cursor="rayOrigin: mouse">
            
            <a-entity id="contenedor-principal" position="0 0.5 0"></a-entity>
            
          </a-marker>
          
          <!-- C√°mara con configuraci√≥n √≥ptima para m√≥viles -->
          <a-entity camera 
                    position="0 1.6 0" 
                    look-controls="enabled: true"
                    wasd-controls="enabled: false"
                    cursor="rayOrigin: mouse">
          </a-entity>
        </a-scene>
      `;
      
      console.log('‚úÖ Escena AR construida din√°micamente con configuraci√≥n √≥ptima de c√°mara');
    }

    // ===== CREAR FIGURA 3D CON REGLA GRADUADA EN CENT√çMETROS =====
    function crearFigura3D() {
      const contenedor = document.getElementById('contenedor-principal');
      if (!contenedor) {
        console.error('‚ùå Error: Contenedor principal no encontrado en la escena AR');
        return;
      }
      
      // Limpiar contenedor existente
      contenedor.innerHTML = '';
      
      // Crear modelo principal seg√∫n figura seleccionada
      const modelo = document.createElement('a-entity');
      modelo.setAttribute('id', 'modelo-3d');
      modelo.setAttribute('position', '0 0 0');
      
      // Configuraci√≥n geom√©trica espec√≠fica por tipo de figura
      let geoParams = '';
      let rotation = '0 45 0';
      
      switch(figuraSeleccionada) {
        case 'box':
          geoParams = 'primitive: box; width: 1; height: 1; depth: 1';
          break;
        case 'sphere':
          geoParams = 'primitive: sphere; radius: 0.5; segmentsWidth: 48; segmentsHeight: 48';
          rotation = '0 0 0';
          break;
        case 'cylinder':
          geoParams = 'primitive: cylinder; radius: 0.5; height: 1.5; segmentsRadial: 32';
          break;
        case 'cone':
          geoParams = 'primitive: cone; radiusBottom: 0.5; radiusTop: 0; height: 1.5; segmentsRadial: 24';
          break;
        case 'torus':
          geoParams = 'primitive: torus; radius: 0.5; radiusTubular: 0.15; segmentsRadial: 32; segmentsTubular: 24';
          break;
        case 'tetrahedron':
          geoParams = 'primitive: tetrahedron; radius: 0.6; detail: 0';
          break;
        case 'dodecahedron':
          geoParams = 'primitive: dodecahedron; radius: 0.5; detail: 0';
          break;
        case 'icosahedron':
          geoParams = 'primitive: icosahedron; radius: 0.5; detail: 0';
          break;
        case 'octahedron':
          geoParams = 'primitive: octahedron; radius: 0.6; detail: 0';
          break;
        default:
          geoParams = 'primitive: box; width: 1; height: 1; depth: 1';
      }
      
      modelo.setAttribute('geometry', geoParams);
      modelo.setAttribute('rotation', rotation);
      
      // Material con propiedades realistas
      const materialParams = 'color: #4ECDC4; metalness: 0.35; roughness: 0.45; side: double; shader: standard';
      modelo.setAttribute('material', materialParams);
      
      // Animaci√≥n de rotaci√≥n suave
      if (rotacionActiva) {
        modelo.setAttribute('animation', 'property: rotation; to: 0 360 0; dur: 8000; loop: true; easing: linear');
      }
      
      // Wireframe gu√≠a para mejor percepci√≥n de forma
      const wireframe = document.createElement('a-entity');
      wireframe.setAttribute('id', 'wireframe-guia');
      wireframe.setAttribute('geometry', geoParams);
      wireframe.setAttribute('material', 'wireframe: true; color: #FFE66D; opacity: 0.75; side: double');
      wireframe.setAttribute('scale', '1.05 1.05 1.05');
      wireframe.setAttribute('rotation', rotation);
      wireframe.setAttribute('position', '0 0 0');
      
      // ===== REGLA GRADUADA EN CENT√çMETROS - CORREGIDA Y VISIBLE =====
      // Esta es la parte cr√≠tica que soluciona el problema de la graduaci√≥n
      const reglaGraduada = document.createElement('a-entity');
      reglaGraduada.setAttribute('id', 'regla-graduada');
      reglaGraduada.setAttribute('position', '0 0 0');
      
      // Construir regla con marcaciones claras y legibles en cm
      reglaGraduada.innerHTML = `
        <!-- ===== EJE Y (ALTURA) - AMARILLO - Graduado cada 25cm ===== -->
        <a-entity position="0 0 0">
          <!-- L√≠nea principal del eje Y -->
          <a-cylinder radius="0.022" height="2.0" color="#FFD700" 
                      position="0 0 0"
                      rotation="90 0 0"
                      material="shader: flat; emissive: #FFD700; emissiveIntensity: 0.9; side: double"></a-cylinder>
          
          <!-- Marcas principales (0cm, 50cm, 100cm) -->
          <a-box position="0 -1.0 0" width="0.20" height="0.045" depth="0.045" color="#FFD700" 
                 material="shader: flat; emissive: #FFD700; emissiveIntensity: 1.0; side: double"></a-box>
          <a-text value="0cm" position="0.25 -1.0 0" scale="0.45 0.45 0.45" color="#FFD700" 
                  align="left" side="double" shader="flat"></a-text>
          
          <a-box position="0 -0.5 0" width="0.15" height="0.035" depth="0.035" color="#FFD700" 
                 material="shader: flat; emissive: #FFD700; emissiveIntensity: 0.8; side: double"></a-box>
          <a-text value="50cm" position="0.25 -0.5 0" scale="0.40 0.40 0.40" color="#FFD700" 
                  align="left" side="double" shader="flat"></a-text>
          
          <a-box position="0 0.0 0" width="0.20" height="0.045" depth="0.045" color="#FFD700" 
                 material="shader: flat; emissive: #FFD700; emissiveIntensity: 1.0; side: double"></a-box>
          <a-text value="100cm" position="0.25 0.0 0" scale="0.45 0.45 0.45" color="#FFD700" 
                  align="left" side="double" shader="flat"></a-text>
          
          <a-box position="0 0.5 0" width="0.15" height="0.035" depth="0.035" color="#FFD700" 
                 material="shader: flat; emissive: #FFD700; emissiveIntensity: 0.8; side: double"></a-box>
          <a-text value="150cm" position="0.25 0.5 0" scale="0.40 0.40 0.40" color="#FFD700" 
                  align="left" side="double" shader="flat"></a-text>
          
          <a-box position="0 1.0 0" width="0.20" height="0.045" depth="0.045" color="#FFD700" 
                 material="shader: flat; emissive: #FFD700; emissiveIntensity: 1.0; side: double"></a-box>
          <a-text value="200cm" position="0.25 1.0 0" scale="0.45 0.45 0.45" color="#FFD700" 
                  align="left" side="double" shader="flat"></a-text>
          
          <!-- Etiqueta del eje Y -->
          <a-text value="ALTURA (Y)" position="0.30 1.4 0" scale="0.42 0.42 0.42" color="#FFD700" 
                  align="center" side="double" shader="flat" font="https://cdn.aframe.io/fonts/Roboto-msdf.json"></a-text>
        </a-entity>
        
        <!-- ===== EJE X (ANCHO) - VERDE - Graduado cada 25cm ===== -->
        <a-entity position="0 0 0">
          <!-- L√≠nea principal del eje X -->
          <a-cylinder radius="0.022" height="2.0" color="#00FF88" 
                      position="0 0 0"
                      rotation="90 90 0"
                      material="shader: flat; emissive: #00FF88; emissiveIntensity: 0.9; side: double"></a-cylinder>
          
          <!-- Marcas principales (0cm, 50cm, 100cm) -->
          <a-box position="-1.0 0 0" width="0.045" height="0.20" depth="0.045" color="#00FF88" 
                 material="shader: flat; emissive: #00FF88; emissiveIntensity: 1.0; side: double"></a-box>
          <a-text value="0cm" position="-1.0 -0.32 0" scale="0.45 0.45 0.45" color="#00FF88" 
                  align="center" side="double" shader="flat"></a-text>
          
          <a-box position="-0.5 0 0" width="0.035" height="0.15" depth="0.035" color="#00FF88" 
                 material="shader: flat; emissive: #00FF88; emissiveIntensity: 0.8; side: double"></a-box>
          <a-text value="50cm" position="-0.5 -0.32 0" scale="0.40 0.40 0.40" color="#00FF88" 
                  align="center" side="double" shader="flat"></a-text>
          
          <a-box position="0.0 0 0" width="0.045" height="0.20" depth="0.045" color="#00FF88" 
                 material="shader: flat; emissive: #00FF88; emissiveIntensity: 1.0; side: double"></a-box>
          <a-text value="100cm" position="0.0 -0.32 0" scale="0.45 0.45 0.45" color="#00FF88" 
                  align="center" side="double" shader="flat"></a-text>
          
          <a-box position="0.5 0 0" width="0.035" height="0.15" depth="0.035" color="#00FF88" 
                 material="shader: flat; emissive: #00FF88; emissiveIntensity: 0.8; side: double"></a-box>
          <a-text value="150cm" position="0.5 -0.32 0" scale="0.40 0.40 0.40" color="#00FF88" 
                  align="center" side="double" shader="flat"></a-text>
          
          <a-box position="1.0 0 0" width="0.045" height="0.20" depth="0.045" color="#00FF88" 
                 material="shader: flat; emissive: #00FF88; emissiveIntensity: 1.0; side: double"></a-box>
          <a-text value="200cm" position="1.0 -0.32 0" scale="0.45 0.45 0.45" color="#00FF88" 
                  align="center" side="double" shader="flat"></a-text>
          
          <!-- Etiqueta del eje X -->
          <a-text value="ANCHO (X)" position="1.45 -0.48 0" scale="0.42 0.42 0.42" color="#00FF88" 
                  align="center" side="double" shader="flat" font="https://cdn.aframe.io/fonts/Roboto-msdf.json"></a-text>
        </a-entity>
        
        <!-- ===== EJE Z (PROFUNDIDAD) - ROJO - Graduado cada 25cm ===== -->
        <a-entity position="0 0 0">
          <!-- L√≠nea principal del eje Z -->
          <a-cylinder radius="0.022" height="2.0" color="#FF6B6B" 
                      position="0 0 0"
                      rotation="0 90 90"
                      material="shader: flat; emissive: #FF6B6B; emissiveIntensity: 0.9; side: double"></a-cylinder>
          
          <!-- Marcas principales (0cm, 50cm, 100cm) -->
          <a-box position="0 0 -1.0" width="0.045" height="0.20" depth="0.045" color="#FF6B6B" 
                 material="shader: flat; emissive: #FF6B6B; emissiveIntensity: 1.0; side: double"></a-box>
          <a-text value="0cm" position="0 -0.32 -1.0" scale="0.45 0.45 0.45" color="#FF6B6B" 
                  align="center" side="double" shader="flat"></a-text>
          
          <a-box position="0 0 -0.5" width="0.035" height="0.15" depth="0.035" color="#FF6B6B" 
                 material="shader: flat; emissive: #FF6B6B; emissiveIntensity: 0.8; side: double"></a-box>
          <a-text value="50cm" position="0 -0.32 -0.5" scale="0.40 0.40 0.40" color="#FF6B6B" 
                  align="center" side="double" shader="flat"></a-text>
          
          <a-box position="0 0 0.0" width="0.045" height="0.20" depth="0.045" color="#FF6B6B" 
                 material="shader: flat; emissive: #FF6B6B; emissiveIntensity: 1.0; side: double"></a-box>
          <a-text value="100cm" position="0 -0.32 0.0" scale="0.45 0.45 0.45" color="#FF6B6B" 
                  align="center" side="double" shader="flat"></a-text>
          
          <a-box position="0 0 0.5" width="0.035" height="0.15" depth="0.035" color="#FF6B6B" 
                 material="shader: flat; emissive: #FF6B6B; emissiveIntensity: 0.8; side: double"></a-box>
          <a-text value="150cm" position="0 -0.32 0.5" scale="0.40 0.40 0.40" color="#FF6B6B" 
                  align="center" side="double" shader="flat"></a-text>
          
          <a-box position="0 0 1.0" width="0.045" height="0.20" depth="0.045" color="#FF6B6B" 
                 material="shader: flat; emissive: #FF6B6B; emissiveIntensity: 1.0; side: double"></a-box>
          <a-text value="200cm" position="0 -0.32 1.0" scale="0.45 0.45 0.45" color="#FF6B6B" 
                  align="center" side="double" shader="flat"></a-text>
          
          <!-- Etiqueta del eje Z -->
          <a-text value="PROF (Z)" position="0 -0.48 1.45" scale="0.42 0.42 0.42" color="#FF6B6B" 
                  align="center" side="double" shader="flat" font="https://cdn.aframe.io/fonts/Roboto-msdf.json"></a-text>
        </a-entity>
      `;
      
      // A√±adir todos los elementos al contenedor
      contenedor.appendChild(modelo);
      contenedor.appendChild(wireframe);
      contenedor.appendChild(reglaGraduada);
      
      // Aplicar escala inicial
      aplicarEscala(escalaActual);
      
      // Actualizar mediciones
      actualizarMediciones();
      
      console.log(`‚úÖ Figura 3D creada con regla graduada: ${figuraSeleccionada}`);
      console.log('‚úÖ Regla graduada visible en los 3 ejes con marcaciones cada 25cm');
    }

    // ===== CONFIGURAR EVENTOS DE MARCADOR =====
    function configurarEventosMarcador() {
      const marker = document.querySelector('#hiro-marker');
      if (!marker) {
        console.error('‚ùå Error: Marcador HIRO no encontrado en la escena');
        return;
      }
      
      // Evento cuando se detecta el marcador
      marker.addEventListener('markerFound', () => {
        markerDetectado = true;
        console.log('‚úÖ ¬°Marcador HIRO detectado correctamente!');
        
        const statusText = document.getElementById('camera-status-text');
        statusText.textContent = '‚úÖ ¬°Objeto 3D visible! Mueve el dispositivo para explorar';
        statusText.className = 'status-ok';
        
        // Ocultar mensaje despu√©s de 3 segundos si el marcador sigue detectado
        setTimeout(() => {
          if (markerDetectado) {
            document.getElementById('camera-status').style.display = 'none';
          }
        }, 3000);
        
        // Timeout de ayuda si no se interact√∫a en 15 segundos
        setTimeout(() => {
          if (markerDetectado && arActivo && !medicionesVisibles) {
            mostrarAyudaInteractiva();
          }
        }, 15000);
      });
      
      // Evento cuando se pierde el marcador
      marker.addEventListener('markerLost', () => {
        markerDetectado = false;
        console.log('üîç Marcador HIRO perdido');
        
        const statusText = document.getElementById('camera-status-text');
        statusText.textContent = 'üîç Buscando marcador HIRO... Aseg√∫rate de buena iluminaci√≥n';
        statusText.className = 'status-searching';
        document.getElementById('camera-status').style.display = 'block';
      });
      
      console.log('‚úÖ Eventos de marcador configurados correctamente');
    }

    // ===== FUNCIONES DE CONTROL =====
    function toggleRotacion() {
      rotacionActiva = !rotacionActiva;
      const modelo = document.getElementById('modelo-3d');
      const btn = document.getElementById('btn-rotate');
      
      if (modelo) {
        if (rotacionActiva) {
          modelo.setAttribute('animation', 'property: rotation; to: 0 360 0; dur: 8000; loop: true; easing: linear');
          btn.innerHTML = '‚è∏Ô∏è';
          btn.title = 'Pausar rotaci√≥n del objeto';
          console.log('‚èØÔ∏è Rotaci√≥n reanudada');
        } else {
          modelo.removeAttribute('animation');
          btn.innerHTML = '‚ñ∂Ô∏è';
          btn.title = 'Reanudar rotaci√≥n del objeto';
          console.log('‚è∏Ô∏è Rotaci√≥n pausada');
        }
      }
    }

    function cambiarEscala(delta) {
      // Limitar escala entre 0.3x y 3.0x
      const nuevaEscala = Math.max(0.3, Math.min(3.0, escalaActual + delta));
      
      if (Math.abs(nuevaEscala - escalaActual) < 0.05) {
        return; // Evitar cambios insignificantes
      }
      
      escalaActual = nuevaEscala;
      aplicarEscala(escalaActual);
      
      console.log(`üìè Escala cambiada a: ${escalaActual.toFixed(1)}x`);
    }

    function aplicarEscala(valor) {
      const modelo = document.getElementById('modelo-3d');
      const wireframe = document.getElementById('wireframe-guia');
      
      if (modelo) {
        modelo.setAttribute('scale', `${valor} ${valor} ${valor}`);
      }
      
      if (wireframe) {
        wireframe.setAttribute('scale', `${valor * 1.05} ${valor * 1.05} ${valor * 1.05}`);
      }
      
      // Actualizar mediciones
      actualizarMediciones();
    }

    function toggleMediciones() {
      medicionesVisibles = !medicionesVisibles;
      const panel = document.getElementById('measurements-panel');
      const btn = document.getElementById('btn-measure');
      
      if (medicionesVisibles) {
        panel.style.display = 'block';
        btn.innerHTML = 'üìê';
        btn.title = 'Ocultar mediciones';
        console.log('üìè Mediciones mostradas');
      } else {
        panel.style.display = 'none';
        btn.innerHTML = 'üìè';
        btn.title = 'Mostrar mediciones';
        console.log('üìè Mediciones ocultas');
      }
      
      actualizarMediciones();
    }

    function actualizarMediciones() {
      const dims = dimensionesBase[figuraSeleccionada];
      if (!dims) return;
      
      // Calcular dimensiones reales seg√∫n escala
      const altura = Math.round(dims.altura * escalaActual);
      const ancho = Math.round(dims.ancho * escalaActual);
      const profundidad = Math.round(dims.profundidad * escalaActual);
      
      // Actualizar UI
      document.getElementById('measure-height').innerText = altura;
      document.getElementById('measure-width').innerText = ancho;
      document.getElementById('measure-depth').innerText = profundidad;
      
      // Feedback h√°ptico suave en dispositivos compatibles
      if (navigator.vibrate && medicionesVisibles) {
        navigator.vibrate(20);
      }
    }

    function mostrarAyudaInteractiva() {
      const status = document.getElementById('camera-status');
      status.innerHTML = 'üí° <strong>Consejo:</strong> Usa ‚ûï/‚ûñ para cambiar tama√±o | Toca üìè para ver mediciones en cm';
      status.className = 'status-ok';
      status.style.display = 'block';
      
      setTimeout(() => {
        if (markerDetectado && arActivo) {
          status.style.display = 'none';
        }
      }, 5000);
    }

    function salirAR() {
      if (confirm('¬øVolver al men√∫ principal? Perder√°s la sesi√≥n AR actual.')) {
        console.log('üö™ Saliendo de Realidad Aumentada...');
        
        // Limpiar recursos de c√°mara
        try {
          const video = document.querySelector('video');
          if (video && video.srcObject) {
            video.srcObject.getTracks().forEach(track => {
              track.stop();
              console.log(`‚úÖ Track de c√°mara detenido: ${track.kind}`);
            });
            video.srcObject = null;
          }
        } catch (e) {
          console.log('‚ÑπÔ∏è No se encontraron recursos de c√°mara activos para limpiar');
        }
        
        // Reiniciar estado
        arActivo = false;
        markerDetectado = false;
        sceneLoaded = false;
        escalaActual = 1.0;
        rotacionActiva = true;
        medicionesVisibles = false;
        
        // Recargar interfaz limpia
        location.reload();
      }
    }

    function volverInicio() {
      document.getElementById('menu-overlay').style.display = 'none';
      setTimeout(() => {
        document.getElementById('init-screen').style.display = 'flex';
        document.getElementById('init-screen').classList.remove('hidden');
      }, 400);
    }

    // ===== BLOQUEAR GESTOS PROBLEM√ÅTICOS =====
    function bloquearGestosProblematicos() {
      // Prevenir gestos de pellizco/zoom que rompen AR
      ['gesturestart', 'gesturechange', 'gestureend'].forEach(event => {
        document.addEventListener(event, e => {
          e.preventDefault();
        }, { passive: false });
      });
      
      // Prevenir zoom con gestos de dos dedos
      document.addEventListener('touchmove', e => {
        if (e.touches.length > 1) {
          e.preventDefault();
        }
      }, { passive: false });
      
      // Bloquear zoom con teclas
      document.addEventListener('keydown', e => {
        if ((e.ctrlKey || e.metaKey) && (e.key === '+' || e.key === '-' || e.key === '0' || e.key === '=')) {
          e.preventDefault();
        }
      });
      
      console.log('‚úÖ Gestos problem√°ticos bloqueados para mejor experiencia AR');
    }

    // ===== LIMPIEZA DE RECURSOS AL CERRAR =====
    window.addEventListener('beforeunload', () => {
      if (cameraStream) {
        cameraStream.getTracks().forEach(track => {
          track.stop();
          console.log(`‚úÖ Track detenido al cerrar: ${track.kind}`);
        });
      }
    });

    console.log('‚úÖ WILL AR - Sistema completamente inicializado y listo para uso educativo');
    console.log('üí° Consejo: Imprime el marcador HIRO en tama√±o A4 (100% sin ajustes) para mejor experiencia');
  </script>
</body>
</html>
